<!DOCTYPE html>
<html lang="en">
<head>
    {% include 'std_elements/head.html' %}

    <!-- fontawesome -->
    <script defer src="/static/js/fontawesome/fontawesome.min.js"></script>
    <script defer src="/static/js/fontawesome/solid.min.js"></script>

    <!-- Custom statics -->
    <link rel="stylesheet" href="/static/css/dynamic.css">
    <script src="/static/js/general.js" defer></script>
    <script src="/static/js/dynamic-view.js" defer></script>


    <title>Reservations Week View</title>

    <meta name="view-type" content="{{ view_type }}">
    <meta name="date" content="{{ date }}">

</head>
<body id="page-body">
    
    {% include 'std_elements/body.html' %}
    <div class="layout-wrapper" id="layoutWrapper" data-layout="mixed">

        {# This sets up the header with the given arguments - these are used in the htmx requests #}
        <form id="viewTypeForm"
                hx-get="{{ url_for('cal_bp.fetch_day')}}"
                hx-target=".calendar-container"
                hx-trigger="load, change from:#dateInput, change from:#viewTypeSelect, change from:#hourSelect"
                hx-request='{"timeout": 500}'
                class="layout-header">

                {% include 'std_elements/header.html' %}
        </form>
        
        <div class="calendar-grid" id="calendar-grid"></div>
        <div class="calendar-container" id="calendar-container"></div>

        {% include 'std_elements/footer.html' %}
        
    </div>

    <script> 
        // checks for timeouts
        document.body.addEventListener('htmx:timeout', function(evt) {
            if (evt.target.closest('#viewTypeForm')) {
                document.querySelector('.calendar-container').innerHTML =
                    "<div class='error-box'>Request timed out. Server might be offline.</div>";
            }
        });
        
        
        // This changes background color based on selected viewtype.
        document.addEventListener('DOMContentLoaded', function () {
            const select = document.getElementById('viewTypeSelect');
            const body = document.getElementById('page-body');
        
            if (select && body) {
                const updateBg = () => {
                    const val = select.value;
                    const color = select.dataset[`bg${val.charAt(0).toUpperCase() + val.slice(1)}`] || 'white';
                    body.style.backgroundColor = color;
                };
        
                select.addEventListener('change', updateBg);
                updateBg();
            }
        });
        // make all selects lose focus on option select
        document.addEventListener('DOMContentLoaded', () => {
            const select = document.getElementById('viewTypeSelect');
            select?.addEventListener('change', () => select.blur());
        });

        // make viewheight correct.
        function updateViewportHeight() {
            document.documentElement.style.setProperty('--vh', `${window.innerHeight * 0.01}px`);
          }
          window.addEventListener('resize', updateViewportHeight);
          window.addEventListener('load', updateViewportHeight);
          
        </script>
        
</body>
</html>
