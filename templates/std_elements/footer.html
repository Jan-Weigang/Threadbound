<div class="footer-sheet" id="footer-sheet">
    <!-- User Events -->
    <div class="footer-left">
        <form hx-get="{{ url_for('cal_bp.popup_userevents') }}" method="GET" hx-target="body" hx-swap="beforeend">
            <input hidden value="{{ user.id }}">
            <button type="submit">Meine Events</button>
        </form>
    </div>

    <!-- Help -->
    <div class="footer-center">
        <form hx-get="{{ url_for('cal_bp.popup_shortcuts') }}" method="GET" hx-target="body" hx-swap="beforeend">
            <button type="submit">Hilfe</button>
        </form>
    </div>

    <!-- Logout -->
    <div class="footer-right">
        <form action="{{ url_for('main.logout') }}" method="GET">
            <button id="logoutButton" type="submit">Logout</button>
        </form>
    </div>
    
</div>

<div class="layout-footer">

    <!-- Login / Link to Footer Sheet -->
    <div class="footer-left">
        {% if is_authenticated %}
            <button onclick="toggleFooterSheet()">Men√º</button>
            {% if user.name %} 
                <div class="user-status" style="display: flex; flex-direction: column; position:relative"
                    onmouseover="this.querySelector('.hover-popup').style.display = 'grid';"
                    onmouseout="this.querySelector('.hover-popup').style.display = 'none';">
                        
                        <div class="hover-popup" style="display: none; 
                                                    position: absolute; 
                                                    top: -6rem; left: 0; 
                                                    background: white; 
                                                    border: 1px solid #ccc;
                                                    border-radius: .5rem; 
                                                    box-shadow: 2px 2px 4px rgba(0,0,0,0.2); 
                                                    padding: 0.75rem; 
                                                    font-size: 0.8rem; 
                                                    z-index: 100;
                                                    grid-template-columns: auto auto;
                                                    gap: 0.25rem 1rem;">
                        <div>Mitglied:</div>     <div>{{ user.member }}</div>
                        <div>Beirat:</div>     <div>{{ user.beirat }}</div>
                        <div>Vorstand:</div>   <div>{{ user.vorstand }}</div>
                        <div>Admin:</div>      <div>{{ user.admin }}</div>
                        <div>ID:</div>      <div>{{ user.id }}</div>
                    </div>

                    <span style="font-size: 0.8rem; width: 20ch; color: gray; padding-left: 1rem;">{% if not user.is_member %}Gast:{% else %}Nutzer: {% endif %}</span>
                    <span style="font-size: 0.8rem; width: 20ch; color: gray; padding-left: 1rem; 
                    overflow: hidden; text-overflow: ellipsis; max-width: 20ch; white-space: nowrap;">
                        {{ user.name }}
                    </span>

                </div>
            {% endif %}
        {% else %}
            <form action="{{ url_for('main.login') }}" method="GET">
                <button id="loginButton" type="submit">Login</button>
            </form>
                <div class="user-status" style="display: flex; flex-direction: column;">
                    <span style="font-size: 0.8rem; width: 20ch; color: gray; padding-left: 1rem;"><i>Nicht eingeloggt</i></span>
                    <span style="font-size: 0.8rem; width: 20ch; color: gray; padding-left: 1rem; 
                    overflow: hidden; text-overflow: ellipsis; max-width: 20ch; white-space: nowrap;"></span>
                </div>
        {% endif %}
    </div>


    <!-- View Choices -->
    <div class="footer-center">
        <button class="layout-picker-button" data-layout="day">
            <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg">
                <rect x="2" y="2" width="16" height="4" fill="grey" />
                <rect x="2" y="8" width="16" height="4" fill="grey" />
                <rect x="2" y="14" width="16" height="4" fill="grey" />
            </svg>
        </button>

        <button class="layout-picker-button" data-layout="mixed">
            <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg">
                <!-- Top row with a button -->
                <rect x="2" y="2" width="4" height="4" fill="black" />
                <rect x="8" y="2" width="4" height="4" fill="black" />
                <rect x="14" y="2" width="4" height="4" fill="black" />
                <!-- Horizontal lines in the lower half -->
                <rect x="2" y="8" width="16" height="4" fill="grey" />
                <rect x="2" y="14" width="16" height="4" fill="grey" />
            </svg>
        </button>
        
        <button class="layout-picker-button" data-layout="week">
            <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg">
                <rect x="2" y="2" width="4" height="16" fill="grey" />
                <rect x="8" y="2" width="4" height="16" fill="grey" />
                <rect x="14" y="2" width="4" height="16" fill="grey" />
            </svg>
            {# <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg">
                <rect x="2" y="2" width="4" height="4" fill="black" />
                <rect x="8" y="2" width="4" height="4" fill="black" />
                <rect x="14" y="2" width="4" height="4" fill="black" />
                <rect x="2" y="8" width="4" height="4" fill="black" />
                <rect x="8" y="8" width="4" height="4" fill="black" />
                <rect x="14" y="8" width="4" height="4" fill="black" />
                <rect x="2" y="14" width="4" height="4" fill="black" />
                <rect x="8" y="14" width="4" height="4" fill="black" />
                <rect x="14" y="14" width="4" height="4" fill="black" />
            </svg> #}
        </button>
    </div>


    <!-- Right Section with Info Display -->
    <div class="footer-right">
        <span id="info-display" style="font-style: italic; color: #999999;">
            Hover over items for more info
        </span>
    </div>
</div>


<!-- Inline JavaScript for hover behavior -->
<script>
    function toggleFooterSheet() {
        const sheet = document.getElementById('footer-sheet');
        sheet.classList.toggle('active');
    }

    // Observe changes in the document to add hover events dynamically
    document.addEventListener('DOMContentLoaded', function() {
        initialize_hover();
    });

    function initialize_hover() {
        const infoDisplay = document.getElementById('info-display');
    
        function addHoverListeners(element) {
            element.addEventListener('mouseenter', () => {
                infoDisplay.style.visibility = 'visible';
            });
            element.addEventListener('mousemove', () => {
                // infoDisplay.textContent = element.getAttribute('data-hover-info');
                infoDisplay.innerHTML = element.getAttribute('data-hover-info').replace(/\n/g, '<br>');

            });
            element.addEventListener('mouseleave', () => {
                infoDisplay.style.visibility = 'hidden';
            });

            element.addEventListener('touchstart', () => {
                infoDisplay.style.visibility = 'visible';
            });
            element.addEventListener('touchmove', () => {
                // infoDisplay.textContent = element.getAttribute('data-hover-info');
                infoDisplay.innerHTML = element.getAttribute('data-hover-info').replace(/\n/g, '<br>');

            });
            element.addEventListener('touchend', () => {
                infoDisplay.style.visibility = 'hidden';
            });
        }
    
        // Initialize hover listeners on existing elements
        document.querySelectorAll('[data-hover-info]').forEach(addHoverListeners);
    
        // Use MutationObserver to watch for dynamically added elements
        const observer = new MutationObserver(mutations => {
            mutations.forEach(mutation => {
                mutation.addedNodes.forEach(node => {
                    if (node.nodeType === Node.ELEMENT_NODE && node.hasAttribute('data-hover-info')) {
                        addHoverListeners(node); // Add hover listener for new elements
                    }
                });
            });
        });
    
        observer.observe(document.body, { childList: true, subtree: true });
    }
</script>

